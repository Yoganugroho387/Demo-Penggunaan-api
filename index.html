<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YoGateway API Tester</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #f4f7f6;
            color: #333;
            margin: 0;
            padding: 20px;
        }
        .container {
            max-width: 700px;
            margin: 20px auto;
            background-color: #ffffff;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            overflow: hidden;
        }
        .card {
            padding: 24px;
        }
        .card + .card {
            border-top: 1px solid #eef0f2;
        }
        h1 {
            text-align: center;
            color: #1a202c;
            margin-bottom: 30px;
        }
        h2 {
            border-bottom: 2px solid #007bff;
            padding-bottom: 8px;
            color: #1a202c;
            margin-top: 0;
        }
        .form-group {
            margin-bottom: 16px;
        }
        label {
            display: block;
            font-weight: 600;
            margin-bottom: 6px;
        }
        input[type="text"],
        input[type="number"] {
            width: 100%;
            padding: 12px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            box-sizing: border-box; /* Agar padding tidak menambah width */
            font-size: 16px;
        }
        button {
            background-color: #007bff;
            color: white;
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            transition: background-color 0.2s;
        }
        button:hover {
            background-color: #0056b3;
        }
        .loading {
            display: none;
            text-align: center;
            margin-top: 16px;
            font-style: italic;
            color: #555;
        }
        .result-box {
            margin-top: 20px;
            background-color: #f9f9f9;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 16px;
        }
        .result-box h3 {
            margin-top: 0;
            color: #2c5282;
        }
        .result-box img {
            max-width: 250px;
            height: auto;
            display: block;
            margin: 10px auto;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        .status {
            font-weight: bold;
            padding: 4px 8px;
            border-radius: 4px;
            color: white;
        }
        .status-success { background-color: #28a745; }
        .status-pending { background-color: #ffc107; color: #333; }
        .status-failed { background-color: #dc3545; }
        
        pre {
            background-color: #2d2d2d;
            color: #f8f8f2;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            font-family: "Courier New", Courier, monospace;
            font-size: 14px;
        }
        .error {
            color: #dc3545;
            font-weight: bold;
        }
        .copy-btn {
            background-color: #6c757d;
            font-size: 12px;
            padding: 4px 8px;
            width: auto;
            margin-left: 10px;
        }
        .copy-btn:hover {
            background-color: #5a6268;
        }
    </style>
</head>
<body>

    <div class="container">
        <h1><img src="https://yogateway.web.id/assets/img/logo.png" alt="YoGateway Logo" style="width: 50px; vertical-align: middle; margin-right: 10px;"> YoGateway Tester</h1>
        
        <div class="card">
            <h2>Buat Pembayaran (Create Payment)</h2>
            <div class="form-group">
                <label for="amount">Jumlah (Amount)</label>
                <input type="number" id="amount" placeholder="Contoh: 10000" value="100">
            </div>
            <button onclick="createPayment()">Buat QRIS</button>
            <div id="loadingCreate" class="loading">Membuat permintaan...</div>
            
            <div id="createResult" class="result-box" style="display:none;">
                </div>
        </div>

        <div class="card">
            <h2>Cek Status Pembayaran</h2>
            <div class="form-group">
                <label for="trxid">Transaction ID (trxid)</label>
                <input type="text" id="trxid" placeholder="Contoh: YO-A1B2C3D4">
            </div>
            <button onclick="checkStatus()">Cek Status</button>
            <div id="loadingCheck" class="loading">Mengecek status...</div>
            
            <div id="statusResult" class="result-box" style="display:none;">
                </div>
        </div>
    </div>

    <script>
        // --- Konfigurasi ---
        const API_KEY = "yo_sec_08fbf1c262f6663dec62ef6978707182";
        const BASE_URL = "https://yogateway.web.id/api.php";

        // --- Fungsi untuk Create Payment ---
        async function createPayment() {
            const amount = document.getElementById('amount').value;
            const resultDiv = document.getElementById('createResult');
            const loadingDiv = document.getElementById('loadingCreate');

            if (!amount) {
                alert('Silakan masukkan jumlah (amount).');
                return;
            }

            loadingDiv.style.display = 'block';
            resultDiv.style.display = 'none';
            resultDiv.innerHTML = '';

            const url = `${BASE_URL}?action=createpayment&apikey=${API_KEY}&amount=${amount}`;

            try {
                const response = await fetch(url);
                const data = await response.json();

                if (data.status === true && data.result) {
                    const result = data.result;
                    resultDiv.innerHTML = `
                        <h3>Permintaan Berhasil!</h3>
                        <p><strong>TRX ID:</strong> ${result.trxid} 
                           <button class="copy-btn" onclick="copyToClipboard('${result.trxid}', true)">Copy TRX ID</button>
                        </p>
                        <p><strong>Nominal Tagihan:</strong> Rp ${new Intl.NumberFormat('id-ID').format(result.nominal)}</p>
                        <p><strong>Kadaluarsa:</strong> ${new Date(result.expired).toLocaleString('id-ID')}</p>
                        <img src="${result.qris_image}" alt="QRIS Payment Code">
                        <hr>
                        <h4>Raw Response JSON:</h4>
                        <pre>${JSON.stringify(data, null, 2)}</pre>
                    `;
                } else {
                    resultDiv.innerHTML = `
                        <h3 class="error">Permintaan Gagal</h3>
                        <p>${data.message || 'Terjadi kesalahan. Cek respons di bawah.'}</p>
                        <pre>${JSON.stringify(data, null, 2)}</pre>
                    `;
                }

            } catch (error) {
                resultDiv.innerHTML = `<h3 class="error">Error Jaringan</h3><p>${error.message}</p>`;
                console.error('Fetch error:', error);
            } finally {
                loadingDiv.style.display = 'none';
                resultDiv.style.display = 'block';
            }
        }

        // --- Fungsi untuk Check Status ---
        async function checkStatus() {
            const trxid = document.getElementById('trxid').value;
            const resultDiv = document.getElementById('statusResult');
            const loadingDiv = document.getElementById('loadingCheck');

            if (!trxid) {
                alert('Silakan masukkan TRX ID.');
                return;
            }

            loadingDiv.style.display = 'block';
            resultDiv.style.display = 'none';
            resultDiv.innerHTML = '';

            const url = `${BASE_URL}?action=checkstatus&apikey=${API_KEY}&trxid=${trxid}`;

            try {
                const response = await fetch(url);
                const data = await response.json();

                if (data.status === true && data.result) {
                    const result = data.result;
                    let statusClass = '';
                    switch (result.status.toUpperCase()) {
                        case 'SUCCESS': statusClass = 'status-success'; break;
                        case 'PENDING': statusClass = 'status-pending'; break;
                        case 'FAILED':
                        case 'EXPIRED': 
                            statusClass = 'status-failed'; break;
                        default: statusClass = '';
                    }

                    resultDiv.innerHTML = `
                        <h3>Status Transaksi</h3>
                        <p><strong>TRX ID:</strong> ${result.trxid}</p>
                        <p><strong>Amount:</strong> Rp ${new Intl.NumberFormat('id-ID').format(result.amount)}</p>
                        <p><strong>Status:</strong> <span class="status ${statusClass}">${result.status}</span></p>
                        <hr>
                        <h4>Raw Response JSON:</h4>
                        <pre>${JSON.stringify(data, null, 2)}</pre>
                    `;
                } else {
                     resultDiv.innerHTML = `
                        <h3 class="error">Gagal Cek Status</h3>
                        <p>${data.message || 'TRX ID tidak ditemukan atau terjadi kesalahan.'}</p>
                        <pre>${JSON.stringify(data, null, 2)}</pre>
                    `;
                }

            } catch (error) {
                resultDiv.innerHTML = `<h3 class="error">Error Jaringan</h3><p>${error.message}</p>`;
                console.error('Fetch error:', error);
            } finally {
                loadingDiv.style.display = 'none';
                resultDiv.style.display = 'block';
            }
        }
        
        // --- Fungsi Helper untuk Copy ---
        function copyToClipboard(text, autoFillCheck) {
            navigator.clipboard.writeText(text).then(() => {
                alert('TRX ID berhasil disalin: ' + text);
                if (autoFillCheck) {
                    document.getElementById('trxid').value = text;
                }
            }, (err) => {
                console.error('Gagal menyalin: ', err);
            });
        }
    </script>

</body>
</html>        <!-- Informasi Transaksi -->
        <div id="qris-info" class="p-4 bg-blue-50 border border-blue-200 rounded-lg shadow-inner">
            <p class="text-sm text-blue-800">
                <strong>Status:</strong> <span id="payment-status" class="font-medium">Menunggu input nominal...</span>
            </p>
            <p class="text-sm text-blue-800">
                <strong>TRX ID:</strong> <span id="current-trxid" class="font-mono text-xs bg-blue-100 px-2 py-0.5 rounded">N/A</span>
            </p>
        </div>

        <!-- Tampilan QRIS -->
        <div id="qris-result" class="flex flex-col items-center justify-center min-h-[150px]">
        </div>

        <!-- Bagian 2: Cek Status -->
        <div class="space-y-4 pt-4 border-t">
            <h2 class="text-xl font-semibold text-gray-700">2. Cek Status Pembayaran</h2>
            <button id="check-status-btn" onclick="checkPaymentStatus()" disabled
                    class="w-full bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-4 rounded-lg transition duration-300 shadow-md disabled:opacity-50 disabled:cursor-not-allowed">
                Cek Status Transaksi
            </button>
            <div id="status-info" class="p-4 border rounded-lg">
                <p class="font-semibold text-gray-800">Hasil Cek Status:</p>
                <div id="status-result" class="mt-1 text-lg font-bold text-gray-500">N/A</div>
            </div>
        </div>

        <!-- Log Respon API -->
        <div class="space-y-2 pt-4 border-t">
            <h2 class="text-sm font-semibold text-gray-700">Log Respon API Terakhir</h2>
            <pre id="api-response" class="bg-gray-800 text-green-400 p-3 rounded-lg text-xs overflow-x-auto whitespace-pre-wrap">Belum ada respons.</pre>
        </div>

    </div>

    <script>
        // --- KONFIGURASI API ---
        // Kita tidak memanggil BASE_URL langsung. Kita panggil Serverless Function di domain yang sama.
        const PROXY_ENDPOINT = '/api/proxy'; 
        const API_KEY = 'demo123'; // API Key tetap dikirim
        let currentTrxId = null; 

        // --- REFERENSI DOM ---
        const nominalInput = document.getElementById('nominal');
        const qrisResultDiv = document.getElementById('qris-result');
        const statusText = document.getElementById('payment-status');
        const trxidText = document.getElementById('current-trxid');
        const checkBtn = document.getElementById('check-status-btn');
        const statusResultDiv = document.getElementById('status-result');
        const apiResponsePre = document.getElementById('api-response');

        function displayApiResponse(data) {
            apiResponsePre.textContent = JSON.stringify(data, null, 2);
        }

        async function createPayment() {
            const amount = nominalInput.value.trim();

            if (!amount || parseInt(amount) < 100) {
                alert("Masukkan nominal yang valid (min. 100).");
                return;
            }
            
            statusText.textContent = 'Sedang memproses via proxy...';
            qrisResultDiv.innerHTML = '<svg class="animate-spin h-5 w-5 text-blue-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>';
            checkBtn.disabled = true;

            // Memanggil Serverless Function (proxy) di domain yang sama
            const url = `${PROXY_ENDPOINT}?action=createpayment&apikey=${API_KEY}&amount=${amount}`;

            try {
                const response = await fetch(url);
                const data = await response.json();
                
                displayApiResponse(data);

                if (data.status === true && data.result) {
                    const { trxid, nominal, qris_image } = data.result;
                    
                    currentTrxId = trxid; 
                    trxidText.textContent = trxid;
                    statusText.textContent = `QRIS berhasil dibuat, nominal: Rp${nominal}`;
                    
                    qrisResultDiv.innerHTML = `
                        <p class="text-sm text-center text-gray-600 mb-2">Scan QRIS ini untuk membayar:</p>
                        <img src="${qris_image}" alt="QRIS Pembayaran" class="rounded-lg shadow-lg w-48 h-48">
                    `;
                    
                    checkBtn.disabled = false;
                } else {
                    statusText.textContent = `Gagal membuat QRIS: ${data.result || 'Kesalahan tidak diketahui'}`;
                    qrisResultDiv.innerHTML = '';
                    currentTrxId = null;
                    trxidText.textContent = 'N/A';
                }

            } catch (error) {
                console.error("Error creating payment:", error);
                apiResponsePre.textContent = `Error Koneksi Proxy: ${error.message}. Pastikan file /api/proxy.js sudah di-deploy dengan benar di Vercel.`;
                statusText.textContent = `Terjadi kesalahan saat memanggil proxy.`;
                qrisResultDiv.innerHTML = '';
            }
        }

        async function checkPaymentStatus() {
            
            if (!currentTrxId) {
                statusResultDiv.innerHTML = '<span class="text-red-500">Harap buat QRIS terlebih dahulu!</span>';
                return;
            }
            
            statusResultDiv.innerHTML = `<span class="text-blue-500">Mengecek status untuk TRX ID ${currentTrxId} via proxy...</span>`;

            // Memanggil Serverless Function (proxy) di domain yang sama
            const url = `${PROXY_ENDPOINT}?action=checkstatus&trxid=${currentTrxId}`;

            try {
                const response = await fetch(url);
                const data = await response.json();
                
                displayApiResponse(data);

                if (data.status === true && data.result) {
                    const paymentStatus = data.result.status;
                    const amountPaid = data.result.amount;
                    
                    let displayStatus = `Status: ${paymentStatus} | Nominal: Rp${amountPaid}`;
                    
                    let colorClass = 'text-gray-500';
                    if (paymentStatus === 'SUCCESS') {
                        colorClass = 'text-green-600';
                    } else if (paymentStatus === 'PENDING') {
                        colorClass = 'text-yellow-600';
                    } else if (paymentStatus === 'EXPIRED') {
                        colorClass = 'text-red-600';
                    }

                    statusResultDiv.innerHTML = `<span class="${colorClass}">${displayStatus}</span>`;

                } else {
                    statusResultDiv.innerHTML = `<span class="text-red-500">Gagal mendapatkan status: ${data.result || 'Kesalahan tidak diketahui'}</span>`;
                }

            } catch (error) {
                console.error("Error checking status:", error);
                apiResponsePre.textContent = `Error Koneksi Proxy: ${error.message}.`;
                statusResultDiv.innerHTML = `<span class="text-red-500">Terjadi kesalahan saat memanggil proxy.</span>`;
            }
        }
    </script>
</body>
</html>


            </div>

        <h2>2. Cek Status Pembayaran</h2>
        <p>Gunakan tombol di bawah untuk mengecek status transaksi QRIS yang baru dibuat.</p>
        <button id="check-status-btn" onclick="checkPaymentStatus()" disabled>Cek Status Transaksi</button>

        <div id="status-info">
            <p><strong>Hasil Cek Status:</strong> <span id="status-result">N/A</span></p>
        </div>

        <h2>Log Respon API Terakhir</h2>
        <div id="api-response">
            Belum ada respons.
        </div>
    </div>

    <script>
        // --- KONFIGURASI ---
        const API_KEY = 'demo123'; 
        const BASE_URL = 'https://yogateway.yotemp.web.id/api.php';
        let currentTrxId = null; // Variabel global untuk menyimpan ID Transaksi

        /**
         * Fungsi untuk memanggil endpoint "Create Payment" dan membuat QRIS.
         */
        async function createPayment() {
            const amount = document.getElementById('nominal').value.trim();
            const qrisResultDiv = document.getElementById('qris-result');
            const statusText = document.getElementById('payment-status');
            const trxidText = document.getElementById('current-trxid');
            const checkBtn = document.getElementById('check-status-btn');

            if (!amount || parseInt(amount) < 100) {
                alert("Masukkan nominal yang valid (min. 100).");
                return;
            }
            
            // Tampilan loading
            statusText.textContent = 'Sedang memproses...';
            qrisResultDiv.innerHTML = '<p>Membuat QRIS, mohon tunggu...</p>';
            checkBtn.disabled = true;

            const url = `${BASE_URL}?action=createpayment&apikey=${API_KEY}&amount=${amount}`;

            try {
                const response = await fetch(url);
                const data = await response.json();
                
                document.getElementById('api-response').textContent = JSON.stringify(data, null, 2);

                if (data.status === true && data.result) {
                    const { trxid, nominal, qris_image } = data.result;
                    
                    // Simpan TRX ID ke variabel global
                    currentTrxId = trxid; 

                    // Update UI dengan info transaksi
                    trxidText.textContent = trxid;
                    statusText.textContent = 'QRIS berhasil dibuat, nominal: Rp' + nominal;
                    
                    // Tampilkan gambar QRIS
                    qrisResultDiv.innerHTML = `<img src="${qris_image}" alt="QRIS Pembayaran">`;
                    
                    // Aktifkan tombol cek status
                    checkBtn.disabled = false;
                } else {
                    // Penanganan error saat pembuatan QRIS
                    statusText.textContent = `Gagal membuat QRIS: ${data.result || 'Kesalahan tidak diketahui'}`;
                    qrisResultDiv.innerHTML = '';
                    currentTrxId = null;
                    trxidText.textContent = 'N/A';
                }

            } catch (error) {
                console.error("Error creating payment:", error);
                document.getElementById('api-response').textContent = `Error: ${error.message}`;
                statusText.textContent = `Terjadi kesalahan koneksi/server.`;
                qrisResultDiv.innerHTML = '';
            }
        }

        /**
         * Fungsi untuk memanggil endpoint "Check Status".
         */
        async function checkPaymentStatus() {
            const statusResultText = document.getElementById('status-result');
            
            if (!currentTrxId) {
                statusResultText.textContent = 'Harap buat QRIS terlebih dahulu!';
                return;
            }
            
            // Tampilan loading
            statusResultText.textContent = `Mengecek status untuk TRX ID ${currentTrxId}...`;

            // Endpoint Check Status
            const url = `${BASE_URL}?action=checkstatus&trxid=${currentTrxId}`;

            try {
                const response = await fetch(url);
                const data = await response.json();
                
                document.getElementById('api-response').textContent = JSON.stringify(data, null, 2);

                if (data.status === true && data.result) {
                    const paymentStatus = data.result.status; // Contoh: PENDING, SUCCESS, EXPIRED
                    const amountPaid = data.result.amount;
                    
                    let displayStatus = `Status: **${paymentStatus}** | Nominal: Rp${amountPaid}`;
                    
                    // Beri warna status
                    if (paymentStatus === 'SUCCESS') {
                        displayStatus = `<span style="color: green;">${displayStatus}</span>`;
                    } else if (paymentStatus === 'PENDING') {
                        displayStatus = `<span style="color: orange;">${displayStatus}</span>`;
                    } else {
                        displayStatus = `<span style="color: red;">${displayStatus}</span>`;
                    }

                    statusResultText.innerHTML = displayStatus;
                } else {
                    statusResultText.textContent = `Gagal mendapatkan status: ${data.result || 'Kesalahan tidak diketahui'}`;
                }

            } catch (error) {
                console.error("Error checking status:", error);
                document.getElementById('api-response').textContent = `Error: ${error.message}`;
                statusResultText.textContent = `Terjadi kesalahan koneksi/server saat cek status.`;
            }
        }
    </script>
</body>
  </html>
  
